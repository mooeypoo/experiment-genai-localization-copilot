# Agent Notes 07

## 1) Summary
- Implemented full internationalization (i18n) support for English, French, and Spanish.
- Integrated Vue I18n library with composition API pattern.
- Created structured translation files for all UI text across the application.
- Added language switcher component with flag indicators and persistent selection.
- Translated navigation, forms, validation messages, dynamic text, and UI labels.
- Validation error keys are returned from the data layer and translated in components.

## 2) Decisions & Rationale

**Library Selection: Vue I18n v9**
Selected vue-i18n as the de facto standard for Vue 3 internationalization. Despite the deprecation warning suggesting v11, v9 is stable, well-documented, and sufficient for this project's scope. The composition API mode (legacy: false) aligns with the app's existing architecture.

**Translation Key Structure**
Organized translations hierarchically by feature domain:
- `app.*` - Global app branding and navigation
- `post.*` - Post-specific content and comments
- `comment.*` - Comment form and display
- `user.*` - User creation, listing, and community text
- `profile.*` - Profile-specific messages
- `validation.*` - All validation error messages
- `charCounter.*` - Character counter text

This structure makes translations discoverable, maintainable, and reduces key conflicts.

**Locale Persistence**
Implemented localStorage-based locale persistence so users don't lose their language preference on refresh. The selected language is saved immediately on change and restored on app initialization. This provides a consistent experience across sessions without requiring backend state management.

**Validation Message Architecture**
Chose to return translation keys (e.g., 'validation.displayNameRequired') from the data layer rather than translated strings. This keeps the data layer agnostic of the i18n system and allows components to translate at render time based on the current locale. The pattern:
1. Store validation functions return translation keys
2. Components receive keys and translate with `t(error)`
3. Error messages automatically update when language changes

This architecture maintains separation of concerns - the data layer handles business logic, components handle presentation.

**Pluralization Strategy**
Used vue-i18n's built-in pluralization for count-based messages:
- `commentsCount: "{count} comments | {count} comment | {count} comments"`
- The pipe-separated format handles: 0, 1, and 2+ cases
- Not all languages follow the same pluralization rules, so this structure is flexible

French and Spanish have different plural rules than English, which this pattern accommodates.

**Dynamic Text Translation**
For pronoun-based dynamic messages, used interpolation with translation keys:
```javascript
t(`profile.viewActivity.${getPronounReference(user.pronouns)}`)
```
This allows different translations for her/his/their while keeping the logic simple.

**Language Switcher Design**
Placed the language switcher in the header alongside the viewing user selector. Design choices:
- Dropdown select with language names for choice
- Minimal styling to match existing header aesthetic
- Selection updates immediately when choice changes

The language names are displayed in their native language (English, Français, Español) for clarity.

**Content vs UI Translation**
Made a clear distinction between UI text (translated) and user-generated content (not translated):
- UI labels, buttons, navigation → translated
- Seed data (post content, user bios, comments) → kept in English as user-generated content
- Only the post title is translated since it's part of the demo narrative

In a production app, user content would remain in the user's original language, so this approach is realistic.

**Translation Quality**
French and Spanish translations aim for natural, conversational tone matching the app's friendly aesthetic. Key considerations:
- "iel" for French non-binary pronoun (modern usage)
- "elle" for Spanish non-binary pronoun (emerging inclusive usage)
- Formal "vous" avoided in French in favor of inclusive neutral constructions
- Spanish uses gender-neutral "personas" rather than gendered forms

Translations were crafted for clarity over literal word-for-word conversion.

## 3) Ambiguities Encountered

**Whether to translate seed data:**
- Options considered: 
  - (a) translate all content including user bios and comments
  - (b) keep user content in original language, translate only UI
  - (c) add multilingual seed data with different users per language
- Resolution: kept user-generated content in English as it represents authentic user input. Only translated the post title as a demonstration piece since it's the app's showcase content.
- Rationale: respects the reality that user content should preserve the author's language choice.

**Pronoun translation across languages:**
- Options considered:
  - (a) map English pronouns to equivalent forms in each language
  - (b) let users select pronouns per language
  - (c) show pronouns in original language regardless of UI language
- Resolution: mapped pronouns to culturally appropriate equivalents (she/her → elle, he/him → il, they/them → iel/elle)
- Challenge: non-binary pronouns vary by region (French "iel" vs "they", Spanish "elle" vs "@")
- Rationale: users expect localized pronouns, and the options chosen represent modern inclusive usage.

**Validation message timing:**
- Options considered:
  - (a) translate at validation time in store
  - (b) return keys and translate in components
  - (c) create separate validation files per language
- Resolution: return translation keys from store, translate in components
- Rationale: keeps data layer independent of i18n, allows dynamic language switching without re-validation, simpler architecture.

**Pluralization complexity:**
- Options considered:
  - (a) use simple concatenation with conditional logic
  - (b) leverage vue-i18n pluralization
  - (c) avoid plurals by rewording ("comment count: X")
- Resolution: used vue-i18n pluralization with pipe syntax
- Challenge: different languages have different plural rules (French has 0/1/2+ distinction)
- Rationale: vue-i18n handles this automatically, future-proof for more languages.

**Default language selection:**
- Options considered:
  - (a) detect from browser locale
  - (b) default to English
  - (c) remember last selection
- Resolution: default to English with localStorage persistence
- Rationale: explicit user choice is more reliable than auto-detection; stored preference provides continuity.

**Language switcher placement:**
- Options considered:
  - (a) in header with other controls
  - (b) footer only
  - (c) both header and footer
  - (d) separate settings page
- Resolution: header placement alongside viewing user selector
- Rationale: high visibility for a demo app showcasing i18n, consistent with other global controls.

**Character counter translation:**
- Options considered:
  - (a) format entirely in component logic
  - (b) create translation templates with placeholders
  - (c) separate translations for each counter state
- Resolution: translation templates with `{current}`, `{max}`, `{count}` placeholders
- Rationale: allows different languages to reorder elements naturally while keeping logic centralized.

**Fallback strategy:**
- Options considered:
  - (a) show translation keys if translation missing
  - (b) fall back to English
  - (c) show error indicators
- Resolution: configured fallbackLocale as 'en'
- Rationale: English is the development language; always having readable fallback text is better than showing keys or errors.

## 4) Tradeoffs

**Translation Keys vs Inline Text:**
- Chose translation keys throughout, adding indirection.
- Tradeoff: more files to maintain, harder to see actual text when reading component code.
- Benefit: centralized translations, easier to update, supports language switching without code changes.

**localStorage vs URL/Route-based Locale:**
- Used localStorage for persistence.
- Tradeoff: doesn't sync across tabs, not SEO-friendly, not shareable via URL.
- Benefit: simpler implementation, no routing complexity, persists across sessions.

**Comprehensive vs Minimal Translation:**
- Translated all UI text including small details like character counters.
- Tradeoff: more translation work, larger locale files.
- Benefit: complete localized experience, demonstrates full i18n capability.

**Text Labels vs Visual Indicators:**
- Used text-only language names rather than icon library or flag emoji.
- Tradeoff: slightly less visually distinctive than emoji or icons.
- Benefit: maximum clarity, zero rendering issues, better accessibility, simpler implementation.

**Pronoun Mapping vs Pronoun Input:**
- Hardcoded pronoun mappings per language rather than free input.
- Tradeoff: limits expression, may not cover all cultural contexts.
- Benefit: consistent data, predictable translations, avoids translation complexity.

**Vue I18n v9 vs v11:**
- Stayed with v9 despite deprecation warning.
- Tradeoff: using deprecated version, might need upgrade later.
- Benefit: stable, well-documented, works perfectly for current needs.

## 5) Non-Goals

- Content translation (user-generated posts, comments, bios remain in original language)
- Right-to-left (RTL) language support (Arabic, Hebrew)
- Automatic locale detection from browser settings
- Admin interface for managing translations
- Translation memory or CAT tool integration
- Crowdsourced translation capabilities
- Language-specific date/time formatting beyond default
- Currency or number localization
- Pluralization beyond standard count rules
- Gendered language support in languages with grammatical gender for all nouns
- Professional translation review (translations are functional but not professionally reviewed)
- Accessibility announcements when language changes

## 6) Files Changed
- Added: [src/locales/en.json](../../src/locales/en.json)
- Added: [src/locales/fr.json](../../src/locales/fr.json)
- Added: [src/locales/es.json](../../src/locales/es.json)
- Added: [src/i18n.js](../../src/i18n.js)
- Added: [src/components/LanguageSwitcher.vue](../../src/components/LanguageSwitcher.vue)
- Updated: [src/main.js](../../src/main.js)
- Updated: [src/components/HeaderBar.vue](../../src/components/HeaderBar.vue)
- Updated: [src/components/NavigationBar.vue](../../src/components/NavigationBar.vue)
- Updated: [src/components/ViewingAsSelector.vue](../../src/components/ViewingAsSelector.vue)
- Updated: [src/components/CommentList.vue](../../src/components/CommentList.vue)
- Updated: [src/components/CommentItem.vue](../../src/components/CommentItem.vue)
- Updated: [src/components/CommentForm.vue](../../src/components/CommentForm.vue)
- Updated: [src/components/UserForm.vue](../../src/components/UserForm.vue)
- Updated: [src/components/UserList.vue](../../src/components/UserList.vue)
- Updated: [src/components/UserProfileCard.vue](../../src/components/UserProfileCard.vue)
- Updated: [src/views/UserProfileView.vue](../../src/views/UserProfileView.vue)
- Updated: [src/data/store.js](../../src/data/store.js)
- Updated: [src/style.css](../../src/style.css)
- Added: [docs/agent-notes/07.md](07.md)

## 7) Manual Verification Checklist
- Run `npm run dev` and verify the app loads without errors.
- Confirm default language is English and all text displays correctly.
- Click the language switcher and select French (Français).
- Verify all UI text changes to French: navigation, forms, buttons, labels.
- Check character counter displays French text: "X / 160 (X restants)".
- Try to create a user and verify validation errors appear in French.
- Navigate to Users page and verify "Communauté" header and count in French.
- View a user profile and check pronoun-based message is translated.
- Switch to Spanish (Español) and repeat verification.
- Refresh the page and confirm language selection persists.
- Create a comment and verify form labels and button text are translated.
- Check pronouns dropdown shows translated options in each language.
- Try submitting forms with validation errors in each language.
- Check mobile responsive view - language switcher should remain accessible.
- Open browser console and verify no i18n-related errors or warnings.
- Test keyboard navigation through language switcher dropdown.

## 8) Known Issues / Follow-ups

**Visual Indicators:**
- Currently using text-only language names without visual badges.
- Could add icon library (e.g., Flag Icons CSS) for visual distinction.
- Could add icons or colors to distinguish languages in the dropdown.

**Translation Quality:**
- Translations are functional but not professionally reviewed.
- Some idiomatic expressions may not translate perfectly.
- Would benefit from native speaker review for production.

**Pronoun Inclusivity:**
- Chosen French "iel" and Spanish "elle" may not be universally recognized.
- Some regions prefer different non-binary pronoun options.
- Could add more pronoun choices per language.

**No Dynamic Locale Detection:**
- App doesn't detect browser language preference on first visit.
- Users must manually select if they don't want English.
- Could implement `navigator.language` detection with opt-out.

**Translation Key Errors Silent:**
- If a translation key is missing, vue-i18n shows the key itself.
- No visual indication that translation is missing in production.
- Could add development-mode warnings for missing keys.

**Pluralization Edge Cases:**
- Current pluralization handles 0, 1, many but not all language-specific rules.
- Some languages have complex plural forms (Slavic languages, Arabic).
- vue-i18n supports this but requires more sophisticated rules.

**Character Counter Edge Cases:**
- Character counting doesn't handle grapheme clusters (emoji with modifiers).
- Some languages count characters differently (Chinese characters).
- Could use Intl.Segmenter for more accurate counting.

**Validation Messages in Console:**
- Errors thrown by store functions still contain English keys when logged.
- Console logs aren't translated since they're for developers.
- This is intentional but might confuse non-English developers.

**Language Switch Doesn't Re-render Dynamic Content:**
- Seed data (post title) that's hardcoded in seed.json doesn't change.
- This is intentional (user content shouldn't re-translate).
- But the post title translation shows this limitation.

**Accessibility:**
- Language switcher doesn't announce change to screen readers.
- No ARIA labels for language selection.
- Could add aria-label and aria-live region for better a11y.

**Performance:**
- All three locale files loaded at startup even if only one is used.
- Could implement lazy loading of locale files.
- Current approach is simpler and files are small (~2KB each).

**No Translation Validation:**
- No automated checking that all keys exist in all languages.
- Could have missing translations in French/Spanish.
- Would benefit from a validation script in the build process.
